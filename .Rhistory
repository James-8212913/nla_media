library(tidyverse)
library(tidytext)
library(tidymodels)
library(httr)
library(jsonlite)
library(rvest)
library(robotstxt)
library(RSelenium)
library(seleniumPipes)
library(forcats)
library(lubridate)
packages <- c("tidyverse", "tidymodels", "tidytext", "httr", "jsonlite", "rvest", "robotstxt", "RSelenium", "seleniumpipes", "forcats", "lubridate")
ipak <- function(pkg){
new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
if (length(new.pkg))
install.packages(new.pkg, dependencies = TRUE)
sapply(pkg, require, character.only = TRUE)
}
ipak(packages)
packages <- c("tidyverse", "tidymodels", "tidytext", "httr", "jsonlite", "rvest", "robotstxt", "RSelenium", "seleniumPipes", "forcats", "lubridate")
ipak(packages)
1+1
library(tidyverse)
library(tidytext)
library(tidymodels)
library(httr)
library(jsonlite)
library(rvest)
library(robotstxt)
library(RSelenium)
library(seleniumPipes)
library(forcats)
library(lubridate)
## Set the url to get the data from
base_url <- "https://www.lowyinstitute.org/search?search_text=china"
h <- read_html(base_url)
h
lowy_dates = NULL
lowy_titles = NULL
lowy_urls = NULL
lowy_intro = NULL
counter = 0
lowy_urls = as_tibble(lowy_urls)
lowy_dates = as_tibble(lowy_dates)
lowy_titles = as_tibble(lowy_titles)
lowy_intro = as_tibble(lowy_intro)
for (i in 0:172){
# loop to get the article key items from the teaser pages
counter = i
print(counter)
Sys.sleep(2)
pg = paste0(base_url,"&page=",i) %>% read_html()
urls <- as_tibble(html_nodes(pg, css = '.right-content h2 a') %>% html_attr('href'))
date <- as_tibble(html_nodes(pg, css = '.right-content .date') %>% html_text())
titles <- as_tibble(html_nodes(pg,css = '.right-content h2') %>% html_text())
intro <- as_tibble(html_nodes(pg, css = '.right-content .summary_content') %>% html_text2())
lowy_urls <- bind_rows(lowy_urls, urls)
lowy_dates <- bind_rows(lowy_dates, date)
lowy_titles <- bind_rows(lowy_titles, titles)
lowy_intro <- bind_rows(lowy_intro, intro)
}
# bind the elements together into a tibble
lowy_articles_teaser <- bind_cols(lowy_dates, lowy_titles, lowy_intro, lowy_urls)
# tidy the tibble
lowy_art_teaser <- lowy_articles_teaser %>% rename(date = value...1,
title = value...2,
intro = value...3,
url = value...4) %>%
mutate(
date = dmy(date)
)
lowy_art_teaser
h <- read_html(base_url)
h
lowy_dates = NULL
lowy_titles = NULL
lowy_urls = NULL
lowy_intro = NULL
counter = 0
lowy_urls = as_tibble(lowy_urls)
lowy_dates = as_tibble(lowy_dates)
lowy_titles = as_tibble(lowy_titles)
lowy_intro = as_tibble(lowy_intro)
for (i in 0:172){
# loop to get the article key items from the teaser pages
counter = i
print(counter)
Sys.sleep(2)
pg = paste0(base_url,"&page=",i) %>% read_html()
urls <- as_tibble(html_nodes(pg, css = '.right-content h2 a') %>% html_attr('href'))
date <- as_tibble(html_nodes(pg, css = '.right-content .date') %>% html_text())
titles <- as_tibble(html_nodes(pg,css = '.right-content h2') %>% html_text())
intro <- as_tibble(html_nodes(pg, css = '.right-content .summary_content') %>% html_text2())
lowy_urls <- bind_rows(lowy_urls, urls)
lowy_dates <- bind_rows(lowy_dates, date)
lowy_titles <- bind_rows(lowy_titles, titles)
lowy_intro <- bind_rows(lowy_intro, intro)
}
# tidy the tibble
lowy_art_teaser <- lowy_articles_teaser %>% rename(date = value...1,
title = value...2,
intro = value...3,
url = value...4) %>%
mutate(
date = dmy(date)
)
lowy_art_teaser
## Tidy the text for analysis
intro_count <- lowy_art_teaser %>% unnest_tokens(
word, intro) %>%
anti_join(stop_words) %>%
count(word, sort = TRUE)
# Basic word count
intro_count %>%
filter(n>900) %>%
ggplot(aes(fct_reorder(word, n), n)) +
geom_col() +
coord_flip()
## Tidy the text for analysis
intro_count <- lowy_art_teaser %>% unnest_tokens(
word, intro) %>%
anti_join(stop_words) %>%
count(word, sort = TRUE)
intro_count
# Basic word count
intro_count %>%
filter(n>30) %>%
ggplot(aes(fct_reorder(word, n), n)) +
geom_col() +
coord_flip()
intro_bigram <- lowy_art_teaser %>% unnest_tokens(
bigram, intro, token = "ngrams", n = 3) %>%
separate(bigram, c("word1", "word2", "word3"), sep = " ")
stop_words %>% tail()
intro_bigram <- intro_bigram %>%
filter(!word1 %in% stop_words$word,
!word2 %in% stop_words$word,
!word3 %in% stop_words$word) %>%
drop_na()
intro_bigram %>% count(word1, word2, word3, sort=TRUE)
stop_words <- stop_words %>%
add_row(word  = c("lowy", "fullilove", "NA", "dr", "senior", "michael"), lexicon = "SMART")
stop_words %>% tail()
intro_bigram <- intro_bigram %>%
filter(!word1 %in% stop_words$word,
!word2 %in% stop_words$word,
!word3 %in% stop_words$word) %>%
drop_na()
intro_bigram %>% count(word1, word2, word3, sort=TRUE)
intro_bigram <- intro_bigram %>%
unite(bigram, word1, word2, word3, sep = " ")
intro_bigram %>%
count(bigram, sort = TRUE) %>%
filter(n>3) %>%
ggplot(aes(fct_reorder(bigram, n), n)) +
geom_col() +
coord_flip()
lowy_art_teaser %>%
group_by(year(date)) %>%
count()
lowy_art_teaser %>%
group_by(year(date)) %>%
filter(str_detect(intro, "published")) %>%
count()
lowy_art_teaser
lowy_art_teaser %>% group_by(date(m))
lowy_art_teaser %>% mutate(
month = date(m)
)
lowy_art_teaser %>% mutate(
month = month(date)
)
lowy_art_teaser %>% mutate(
month = month(date)
) %>% group_by(month)
lowy_art_teaser %>% mutate(
month = month(date)
) %>% group_by(month) %>% count()
lowy_art_teaser  %>% tail()
h <- read_html(base_url)
h
lowy_dates = NULL
lowy_titles = NULL
lowy_urls = NULL
lowy_intro = NULL
counter = 0
lowy_urls = as_tibble(lowy_urls)
lowy_dates = as_tibble(lowy_dates)
lowy_titles = as_tibble(lowy_titles)
lowy_intro = as_tibble(lowy_intro)
pg = paste0(base_url,"&page=",i) %>% read_html()
urls <- as_tibble(html_nodes(pg, css = '.right-content h2 a') %>% html_attr('href'))
urls
date <- as_tibble(html_nodes(pg, css = '.right-content .date') %>% html_text())
date
pg
pg = paste0(base_url,"&page=",i) %>% read_html()
pg
lowy_urls <- bind_rows(lowy_urls, urls)
urls
lowy_urls
urls <- as_tibble(html_nodes(pg, css = '.right-content h2 a') %>% html_attr('href'))
lowy_urls <- bind_rows(lowy_urls, urls)
lowy_urls
lowy_art_teaser  %>% head()
lowy_art_teaser
pg = paste0(base_url,"&page=",60) %>% read_html()
pg
urls <- as_tibble(html_nodes(pg, css = '.right-content h2 a') %>% html_attr('href'))
urls
date <- as_tibble(html_nodes(pg, css = '.right-content .date') %>% html_text())
date
titles <- as_tibble(html_nodes(pg,css = '.right-content h2') %>% html_text())
titles
intro <- as_tibble(html_nodes(pg, css = '.right-content .summary_content') %>% html_text2())
intro
base_url <- "https://www.lowyinstitute.org/search?search_text=china"
## read in the url
h <- read_html(base_url)
h
lowy_dates = NULL
lowy_titles = NULL
lowy_urls = NULL
lowy_intro = NULL
counter = 0
lowy_urls = as_tibble(lowy_urls)
lowy_dates = as_tibble(lowy_dates)
lowy_titles = as_tibble(lowy_titles)
lowy_intro = as_tibble(lowy_intro)
for (i in 0:10){
# loop to get the article key items from the teaser pages
counter = i
print(counter)
Sys.sleep(2)
pg = paste0(base_url,"&page=",60) %>% read_html()
urls <- as_tibble(html_nodes(pg, css = '.right-content h2 a') %>% html_attr('href'))
date <- as_tibble(html_nodes(pg, css = '.right-content .date') %>% html_text())
titles <- as_tibble(html_nodes(pg,css = '.right-content h2') %>% html_text())
intro <- as_tibble(html_nodes(pg, css = '.right-content .summary_content') %>% html_text2())
lowy_urls <- bind_rows(lowy_urls, urls)
lowy_dates <- bind_rows(lowy_dates, date)
lowy_titles <- bind_rows(lowy_titles, titles)
lowy_intro <- bind_rows(lowy_intro, intro)
}
# bind the elements together into a tibble
lowy_articles_teaser <- bind_cols(lowy_dates, lowy_titles, lowy_intro, lowy_urls)
# tidy the tibble
lowy_art_teaser <- lowy_articles_teaser %>% rename(date = value...1,
title = value...2,
intro = value...3,
url = value...4) %>%
mutate(
date = dmy(date)
)
lowy_art_teaser
## Set the url to get the data from
base_url <- "https://www.lowyinstitute.org/search?search_text=china"
## read in the url
h <- read_html(base_url)
h
lowy_dates = NULL
lowy_titles = NULL
lowy_urls = NULL
lowy_intro = NULL
counter = 0
lowy_urls = as_tibble(lowy_urls)
lowy_dates = as_tibble(lowy_dates)
lowy_titles = as_tibble(lowy_titles)
lowy_intro = as_tibble(lowy_intro)
for (i in 0:10){
# loop to get the article key items from the teaser pages
counter = i
print(counter)
Sys.sleep(2)
pg = paste0(base_url,"&page=",i) %>% read_html()
urls <- as_tibble(html_nodes(pg, css = '.right-content h2 a') %>% html_attr('href'))
date <- as_tibble(html_nodes(pg, css = '.right-content .date') %>% html_text())
titles <- as_tibble(html_nodes(pg,css = '.right-content h2') %>% html_text())
intro <- as_tibble(html_nodes(pg, css = '.right-content .summary_content') %>% html_text2())
lowy_urls <- bind_rows(lowy_urls, urls)
lowy_dates <- bind_rows(lowy_dates, date)
lowy_titles <- bind_rows(lowy_titles, titles)
lowy_intro <- bind_rows(lowy_intro, intro)
}
# bind the elements together into a tibble
lowy_articles_teaser <- bind_cols(lowy_dates, lowy_titles, lowy_intro, lowy_urls)
# tidy the tibble
lowy_art_teaser <- lowy_articles_teaser %>% rename(date = value...1,
title = value...2,
intro = value...3,
url = value...4) %>%
mutate(
date = dmy(date)
)
lowy_art_teaser
lowy_art_teaser %>% tail()
base_url <- "https://www.lowyinstitute.org/search?search_text=china"
## read in the url
h <- read_html(base_url)
h
lowy_dates = NULL
lowy_titles = NULL
lowy_urls = NULL
lowy_intro = NULL
counter = 0
lowy_urls = as_tibble(lowy_urls)
lowy_dates = as_tibble(lowy_dates)
lowy_titles = as_tibble(lowy_titles)
lowy_intro = as_tibble(lowy_intro)
for (i in 0:172){
# loop to get the article key items from the teaser pages
counter = i
print(counter)
Sys.sleep(3)
pg = paste0(base_url,"&page=",i) %>% read_html()
urls <- as_tibble(html_nodes(pg, css = '.right-content h2 a') %>% html_attr('href'))
date <- as_tibble(html_nodes(pg, css = '.right-content .date') %>% html_text())
titles <- as_tibble(html_nodes(pg,css = '.right-content h2') %>% html_text())
intro <- as_tibble(html_nodes(pg, css = '.right-content .summary_content') %>% html_text2())
lowy_urls <- bind_rows(lowy_urls, urls)
lowy_dates <- bind_rows(lowy_dates, date)
lowy_titles <- bind_rows(lowy_titles, titles)
lowy_intro <- bind_rows(lowy_intro, intro)
}
# bind the elements together into a tibble
lowy_articles_teaser <- bind_cols(lowy_dates, lowy_titles, lowy_intro, lowy_urls)
# tidy the tibble
lowy_art_teaser <- lowy_articles_teaser %>% rename(date = value...1,
title = value...2,
intro = value...3,
url = value...4) %>%
mutate(
date = dmy(date)
)
lowy_art_teaser %>% tail()
lowy_art_teaser
lowy_art_teaser
## Tidy the text for analysis
intro_count <- lowy_art_teaser %>% unnest_tokens(
word, intro) %>%
anti_join(stop_words) %>%
count(word, sort = TRUE)
intro_count
# set the remote driver and load it - firefox browser should open up here
rd <- rsDriver(browser = "firefox")
# set the remote driver and load it - firefox browser should open up here
rd <- rsDriver(browser = "firefox")
remdr <- rd[["client"]]
lowy_art_teaser
write_csv2(lowy_art_teaser, "data/lowy_art_teaser.csv")
write_csv(lowy_art_teaser, "data/lowy_art_teaser.csv")
write_csv(lowy_art_teaser, file = "data/lowy_art_teaser.csv")
write_csv(lowy_art_teaser, file = "lowy_art_teaser.csv")
setwd("~/projects/nla_media")
write_csv(lowy_art_teaser, file = "data/lowy_art_teaser.csv")
